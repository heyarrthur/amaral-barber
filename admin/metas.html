<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Amaral Barbershop — Metas</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <style>
    :root {
      --brand: #0d6efd; /* azul principal */
      --brand-2: #3b82f6; /* azul secundário */
      --card-radius: 1.25rem;
      --shadow-soft: 0 10px 30px rgba(13, 110, 253, 0.12);
      --shadow-hover: 0 14px 38px rgba(13, 110, 253, 0.18);
    }

    /* Tema e visual como as outras páginas */
    body { background: radial-gradient(140% 100% at 10% 0%, #f1f6ff 0%, #ffffff 45%) no-repeat; }
    .navbar {
      background: linear-gradient(90deg, var(--brand) 0%, var(--brand-2) 100%);
      box-shadow: 0 12px 30px rgba(13,110,253,.22); backdrop-filter: saturate(160%) blur(8px);
      border-bottom: 1px solid rgba(255,255,255,.25);
    }
    .navbar .navbar-brand, .navbar .nav-link, .navbar .navbar-text { color: #fff !important; }
    .navbar .nav-link { position: relative; opacity: .95; transition: opacity .2s ease; }
    .navbar .nav-link:hover { opacity: 1; }
    .navbar .nav-link::after { content: ""; position: absolute; left: 0; right: 0; bottom: -6px; height: 2px; background: #fff; transform: scaleX(0); transform-origin: left; transition: transform .25s ease; }
    .navbar .nav-link:hover::after, .navbar .nav-link.active::after { transform: scaleX(1); }

    .app-card { border: none; border-radius: var(--card-radius); box-shadow: var(--shadow-soft); transition: transform .2s ease, box-shadow .2s ease; background: #fff; overflow: hidden; animation: fadeSlideUp .5s ease both; backdrop-filter: saturate(120%) blur(4px); }
    .app-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-hover); }

    .kpi-icon { width: 48px; height: 48px; border-radius: 14px; display: grid; place-items: center; background: radial-gradient(120% 120% at 30% 20%, #fff, rgba(13,110,253,.1)); color: var(--brand); box-shadow: inset 0 -6px 12px rgba(13,110,253,.08); }

    .form-control:focus, .form-select:focus { box-shadow: 0 0 0 .25rem rgba(13,110,253,.25); border-color: rgba(13,110,253,.65); }
    .btn-outline-primary { border-color: rgba(13,110,253,.5); }

    .badge-soft { background: rgba(13,110,253,.08); color: var(--brand); border: 1px solid rgba(13,110,253,.18); }

    @keyframes fadeSlideUp { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

    /* Mobile: cards */
    @media (max-width: 576px) {
      .kpi-stack > .col-12 { margin-bottom: .25rem; }
    }

    .progress { height: .8rem; }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg sticky-top">
    <div class="container">
      <a class="navbar-brand fw-semibold" href="index.html"><i class="bi bi-bar-chart-line me-2"></i>Amaral Barbershop</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMain" aria-controls="navMain" aria-expanded="false" aria-label="Alternar navegação">
        <span class="navbar-toggler-icon" style="filter: invert(1)"></span>
      </button>
      <div class="collapse navbar-collapse" id="navMain">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link" href="index.html">Faturamentos</a></li>
          <li class="nav-item"><a class="nav-link active" aria-current="page" href="#">Metas</a></li>
          <li class="nav-item"><a class="nav-link" href="equipe.html">Equipe</a></li>
        </ul>
        <span class="navbar-text ms-lg-3 small">v2 • painel de <strong>Metas</strong></span>
      </div>
    </div>
  </nav>

  <main class="container py-4 py-lg-5">
    <!-- Cabeçalho -->
    <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between mb-4 gap-3">
      <div>
        <h1 class="h3 mb-1">Metas por Membro</h1>
        <p class="text-secondary mb-0">Defina as metas **no código** e acompanhe o progresso mensal. O realizado fica salvo no seu navegador.</p>
      </div>
      <div class="d-flex flex-wrap gap-2 align-items-center">
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-calendar-event"></i></span>
          <input id="monthPicker" type="month" class="form-control">
        </div>
        <button id="btnZerarMes" class="btn btn-outline-danger"><i class="bi bi-eraser me-1"></i>Zerar realizados (mês)</button>
      </div>
    </div>

    <!-- KPIs -->
    <div class="row g-3 g-lg-4 mb-4 kpi-stack">
      <div class="col-12 col-md-4">
        <div class="app-card p-3 p-lg-4 h-100">
          <div class="d-flex align-items-center gap-3">
            <div class="kpi-icon"><i class="bi bi-bullseye fs-4"></i></div>
            <div>
              <div class="text-secondary small">Meta total do mês</div>
              <div id="kpiMetaTotal" class="h4 mb-0 fw-semibold">R$ 0,00</div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-4">
        <div class="app-card p-3 p-lg-4 h-100">
          <div class="d-flex align-items-center gap-3">
            <div class="kpi-icon"><i class="bi bi-cash-coin fs-4"></i></div>
            <div>
              <div class="text-secondary small">Realizado total</div>
              <div id="kpiRealizadoTotal" class="h4 mb-0 fw-semibold">R$ 0,00</div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-4">
        <div class="app-card p-3 p-lg-4 h-100">
          <div class="d-flex align-items-center gap-3">
            <div class="kpi-icon"><i class="bi bi-graph-up-arrow fs-4"></i></div>
            <div>
              <div class="text-secondary small">% Atingido</div>
              <div id="kpiPct" class="h4 mb-0 fw-semibold">0%</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Busca -->
    <div class="position-relative mb-3">
      <i class="bi bi-search position-absolute" style="left:14px;top:9px;color:#6c757d;"></i>
      <input id="searchInput" type="search" class="form-control form-control-lg" style="border-radius:999px;padding-left:42px" placeholder="Buscar por nome ou função…">
    </div>

    <!-- Lista de metas -->
    <div id="gridMetas" class="row g-3 g-lg-4">
      <!-- cards via JS -->
    </div>

    <div id="emptyState" class="text-center p-4 d-none">
      <div class="kpi-icon mx-auto mb-2" style="width:64px;height:64px"><i class="bi bi-people"></i></div>
      <p class="mb-2">Nenhum membro encontrado. Cadastre a equipe primeiro.</p>
      <a class="btn btn-primary" href="equipe.html"><i class="bi bi-person-plus me-1"></i>Ir para Equipe</a>
    </div>
  </main>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ================== CONFIGURAÇÃO DE METAS (EDITE AQUI) ==================
    // Defina a meta mensal por membro NESTE OBJETO, usando o nome em minúsculas:
    // Exemplo:
    // GOALS_DEFAULT['joão silva'] = 5000;
    // GOALS_DEFAULT['maria'] = 3500;
    const GOALS_DEFAULT = {
      // 'nome do membro em minúsculas': valorDaMeta
      // exemplo:
      // 'joão silva': 5000,
      // 'maria oliveira': 3500,
    };
    // Meta padrão caso o membro não esteja no mapa acima:
    const META_PADRAO = 3000;

    // ================== ESTADO / STORAGE ==================
    const TEAM_KEY = 'ab_team_v1';                 // vem da página equipe
    const PROG_KEY = 'ab_goals_progress_v1';       // progresso mensal salvo aqui (por mês)

    const BRL = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' });
    const getMonthKey = (d = new Date()) => d.toISOString().slice(0,7); // YYYY-MM
    const normalizeName = (s='') => s.normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase().trim();

    let team = [];
    let progress = {}; // { 'YYYY-MM': { 'nome-normalizado': realizadoNumber } }
    let monthKey = getMonthKey();
    let search = '';

    function load() {
      // equipe
      try { team = JSON.parse(localStorage.getItem(TEAM_KEY) || '[]'); } catch { team = []; }
      // progresso
      try { progress = JSON.parse(localStorage.getItem(PROG_KEY) || '{}'); } catch { progress = {}; }
      if (!progress[monthKey]) progress[monthKey] = {};
      saveProgress(); // garante estrutura
    }
    function saveProgress() {
      localStorage.setItem(PROG_KEY, JSON.stringify(progress));
    }

    // ================== RENDER ==================
    function renderAll() {
      renderGrid();
      renderKPIs();
    }

    function renderGrid() {
      const cont = document.getElementById('gridMetas');
      cont.innerHTML = '';
      const list = team
        .filter(m => !search || [m.name, m.role].join(' ').toLowerCase().includes(search.toLowerCase()))
        .map(m => ({ ...m, key: normalizeName(m.name || '') }));

      if (!list.length) {
        document.getElementById('emptyState').classList.remove('d-none');
        return;
      }
      document.getElementById('emptyState').classList.add('d-none');

      list.forEach(m => {
        const meta = getMetaFor(m);
        const done = getDoneFor(m);
        const pct = meta > 0 ? Math.min(100, Math.round((done / meta) * 100)) : 0;
        const status = pct >= 100 ? 'Atingido' : 'Em progresso';

        const col = document.createElement('div');
        col.className = 'col-12 col-md-6 col-lg-4';
        col.innerHTML = `
          <div class="app-card p-3 p-lg-4 h-100">
            <div class="d-flex align-items-start justify-content-between mb-3">
              <div>
                <h5 class="mb-0">${m.name || '-'}</h5>
                <div class="text-secondary small">${m.role || ''}</div>
              </div>
              <span class="badge ${pct>=100 ? 'text-bg-success' : 'badge-soft'}">${status}</span>
            </div>

            <div class="mb-2 d-flex justify-content-between">
              <span class="text-secondary small">Meta do mês</span>
              <strong>${BRL.format(meta)}</strong>
            </div>

            <div class="mb-3">
              <div class="d-flex align-items-center gap-2">
                <span class="text-secondary small">Realizado</span>
                <input type="number" step="0.01" min="0" class="form-control form-control-sm" style="max-width: 140px"
                  value="${Number(done).toFixed(2)}" id="in-${m.key}">
                <button class="btn btn-sm btn-primary" onclick="saveDone('${m.key}')">
                  <i class="bi bi-check2"></i>
                </button>
                <button class="btn btn-sm btn-outline-secondary" onclick="resetDone('${m.key}')">
                  <i class="bi bi-arrow-counterclockwise"></i>
                </button>
              </div>
            </div>

            <div class="progress mb-2" role="progressbar" aria-valuenow="${pct}" aria-valuemin="0" aria-valuemax="100">
              <div class="progress-bar" style="width: ${pct}%">${pct}%</div>
            </div>
            <div class="d-flex justify-content-between small text-secondary">
              <span>Falta</span>
              <span>${BRL.format(Math.max(0, meta - done))}</span>
            </div>

            <div class="mt-3 small text-secondary">
              <i class="bi bi-info-circle me-1"></i>
              Para alterar a meta deste membro, edite o objeto <code>GOALS_DEFAULT</code> no código.
            </div>
          </div>
        `;
        cont.appendChild(col);
      });
    }

    function renderKPIs() {
      const list = team.map(m => ({ key: normalizeName(m.name||''), meta: getMetaFor(m), done: getDoneFor(m) }));
      const metaTotal = list.reduce((s,x)=>s + (x.meta||0), 0);
      const doneTotal = list.reduce((s,x)=>s + (x.done||0), 0);
      const pct = metaTotal > 0 ? Math.round((doneTotal/metaTotal)*100) : 0;

      document.getElementById('kpiMetaTotal').textContent = BRL.format(metaTotal);
      document.getElementById('kpiRealizadoTotal').textContent = BRL.format(doneTotal);
      document.getElementById('kpiPct').textContent = `${pct}%`;
    }

    // ================== HELPERS ==================
    function getMetaFor(member) {
      const key = normalizeName(member.name || '');
      const cfg = GOALS_DEFAULT[key];
      const meta = Number(cfg ?? META_PADRAO);
      return isNaN(meta) ? META_PADRAO : meta;
    }
    function getDoneFor(member) {
      const key = normalizeName(member.name || '');
      const m = progress[monthKey] || {};
      const v = Number(m[key] ?? 0);
      return isNaN(v) ? 0 : v;
    }
    function saveDone(key) {
      const input = document.getElementById(`in-${key}`);
      const val = Number(input.value || 0);
      if (!progress[monthKey]) progress[monthKey] = {};
      progress[monthKey][key] = isNaN(val) ? 0 : val;
      saveProgress(); renderAll();
    }
    function resetDone(key) {
      if (!progress[monthKey]) progress[monthKey] = {};
      progress[monthKey][key] = 0;
      saveProgress(); renderAll();
    }

    // ================== INIT ==================
    document.addEventListener('DOMContentLoaded', () => {
      // mês corrente
      const mp = document.getElementById('monthPicker');
      mp.value = monthKey;
      mp.addEventListener('change', () => {
        monthKey = mp.value || getMonthKey();
        if (!progress[monthKey]) progress[monthKey] = {};
        saveProgress();
        renderAll();
      });

      // busca
      document.getElementById('searchInput').addEventListener('input', (e)=>{ search = e.target.value; renderAll(); });

      // zerar mês
      document.getElementById('btnZerarMes').addEventListener('click', () => {
        if (!confirm('Zerar todos os realizados deste mês?')) return;
        progress[monthKey] = {};
        saveProgress(); renderAll();
      });

      // carregar e renderizar
      load();
      renderAll();

      // Ajuste visual: ícone da navbar toggler
      const toggler = document.querySelector('.navbar-toggler');
      if (toggler) toggler.innerHTML = '<i class="bi bi-list text-white fs-3"></i>';
    });
  </script>
</body>
</html>
