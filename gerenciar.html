<!doctype html>
<html lang="pt-br" data-bs-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gerenciar Equipe • Amaral Barber</title>

  <!-- Bootstrap 5.3 + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root{
      --brand:#0d6efd; --brand-600:#0b5ed7; --ink:#0f172a; --subtle:#6b7280;
      --bg:#f6f8fb; --card:#ffffff; --border:#e6eaf0;
      --chip:#eef2ff; --chip-text:#3730a3;
      --radius:16px; --radius-lg:20px;
      --shadow-sm:0 6px 18px rgba(2,6,23,.06); --shadow-lg:0 20px 50px rgba(2,6,23,.08);
    }
    html, body{height:100%;background:var(--bg);}

    /* Sidebar */
    .sidebar{
      position:fixed; inset:0 auto 0 0; width:300px;
      background:linear-gradient(180deg,#ffffff 0%,#f9fbff 100%);
      border-right:1px solid var(--border); z-index:1040; display:flex; flex-direction:column;
      box-shadow:6px 0 28px rgba(2,6,23,.06);
    }
    .brand{ padding:24px 22px 10px; font-weight:800; color:var(--ink); font-size:1.35rem;}
    .divider{ margin:10px 16px; border-top:1px dashed var(--border); }
    .sub{ padding:12px 20px 6px; font-size:.78rem; color:#94a3b8; text-transform:uppercase; font-weight:700; letter-spacing:.08em;}
    .nav-main{ padding:8px 10px 18px; overflow:auto;}
    .nav-link{ display:flex; align-items:center; gap:12px; padding:12px 14px; border-radius:var(--radius); color:#0f172a; font-weight:600; transition: transform .2s ease, box-shadow .2s ease, background .2s ease;}
    .nav-link .bi{ font-size:1.1rem; opacity:.95;}
    .nav-link:hover{ background: rgba(13,110,253,.09); transform: translateX(3px); box-shadow: var(--shadow-sm);}
    .nav-link.active{ background: var(--brand); color:#fff; box-shadow:0 10px 28px rgba(13,110,253,.28);}
    .btn-as-link{ background:none; border:0; }

    /* Collapse */
    .sidebar.collapsed{ width:84px; }
    .sidebar.collapsed .sub, .sidebar.collapsed .divider, .sidebar.collapsed .mt-auto{ display:none !important; }
    .sidebar.collapsed .brand .title{ display:none; }
    .sidebar .collapse-btn{ margin-left:auto; }
    .sidebar.collapsed .nav-link{ justify-content:center; padding:12px; }
    .sidebar.collapsed .nav-link .label{ display:none; }

    .main{ margin-left:300px; min-height:100%;}
    .main.collapsed{ margin-left:84px; }

    /* Conteúdo */
    .page{ padding:44px; }
    .card-soft{ background:var(--card); border:1px solid var(--border); border-radius:var(--radius-lg); box-shadow:var(--shadow-lg);}
    .card-soft .card-header{ background:transparent; border-bottom:1px solid var(--border); padding:16px 20px;}
    .form-control, .form-select{ padding:.7rem .9rem; border-radius: 12px; border-color: var(--border);}
    .form-control:focus, .form-select:focus{ box-shadow:0 0 0 .25rem rgba(13,110,253,.15); border-color: var(--brand-600);}
    .btn{ border-radius:12px; }

    [data-anim]{ opacity:0; transform: translateY(8px); transition: all .5s ease;}
    [data-anim].in{ opacity:1; transform: translateY(0);}

    .avatar{ width:36px; height:36px; border-radius:50%; background:#e2e8f0; display:inline-flex; align-items:center; justify-content:center; font-weight:700;}

    @media (max-width: 991.98px){
      .sidebar{ transform: translateX(-100%); transition: transform .3s ease;}
      .sidebar.show{ transform: translateX(0);}
      .main{ margin-left:0;}
      .main.collapsed{ margin-left:0;}
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="brand d-flex align-items-center gap-2">
      <i class="bi bi-scissors"></i> <span class="title">Amaral Barber</span>
      <button class="btn btn-light btn-sm collapse-btn" id="btnCollapseSidebar" title="Recolher/expandir" aria-label="Recolher/expandir">
        <i class="bi bi-layout-sidebar-inset"></i>
      </button>
    </div>
    <hr class="divider">
    <nav class="nav-main">
      <button type="button" class="nav-link w-100 text-start btn-as-link" id="btnEarlyAccess" data-bs-toggle="modal" data-bs-target="#earlyModal" title="Acesso Antecipado">
        <i class="bi bi-lightning-charge"></i> <span class="label">Acesso Antecipado</span>
      </button>
      <hr class="divider">
      <div class="sub">Geral</div>
      <a class="nav-link" href="dashboard.html" title="Dashboard"><i class="bi bi-speedometer2"></i> <span class="label">Dashboard</span></a>
      <a class="nav-link" href="parametros.html" title="Parâmetros"><i class="bi bi-sliders"></i> <span class="label">Parâmetros</span></a>
      <hr class="divider">
      <div class="sub">Faturamento</div>
      <a class="nav-link" href="financeiro.html" title="Financeiro"><i class="bi bi-wallet2"></i> <span class="label">Financeiro</span></a>
      <a class="nav-link" href="lancamentos.html" title="Lançamentos Diários"><i class="bi bi-journal-text"></i> <span class="label">Lançamentos Diários</span></a>
      <hr class="divider">
      <div class="sub">Equipe</div>
      <a class="nav-link active" href="gerenciar.html" title="Gerenciar Equipe"><i class="bi bi-people"></i> <span class="label">Gerenciar</span></a>
      <a class="nav-link" href="estatisticas.html" title="Estatísticas"><i class="bi bi-graph-up"></i> <span class="label">Estatísticas</span></a>
    </nav>
    <div class="mt-auto p-3 small text-secondary">
      <div class="d-flex align-items-center gap-2"><i class="bi bi-cloud-check"></i><span>Dados salvos no navegador (LocalStorage)</span></div>
    </div>
  </aside>

  <!-- Main -->
  <main class="main">
    <section class="page container-xxl">
      <div class="row g-4" data-anim>
        <!-- Form + Tabela -->
        <div class="col-12 col-xxl-8">
          <div class="card card-soft">
            <div class="card-header d-flex align-items-center justify-content-between">
              <h5 class="mb-0"><i class="bi bi-person-plus"></i> Cadastro de Membro</h5>
              <div class="d-flex gap-2">
                <button class="btn btn-outline-secondary" id="btnLimpar"><i class="bi bi-eraser"></i> Limpar</button>
                <button class="btn btn-primary" id="btnSalvarMembro"><i class="bi bi-save"></i> Salvar</button>
              </div>
            </div>
            <div class="card-body">
              <form id="formMembro" class="row g-4">
                <input type="hidden" id="membroId">
                <div class="col-md-6">
                  <label class="form-label">Nome completo</label>
                  <input class="form-control" id="nome" placeholder="Ex.: João Silva" required>
                </div>
                <div class="col-md-3">
                  <label class="form-label">Telefone</label>
                  <input class="form-control" id="telefone" placeholder="(00) 00000-0000">
                </div>
                <div class="col-md-3">
                  <label class="form-label">Cargo</label>
                  <select class="form-select" id="cargo">
                    <option value="Barbeiro">Barbeiro</option>
                    <option value="Assistente">Assistente</option>
                  </select>
                </div>

                <div class="col-12">
                  <h6 class="text-secondary mb-2">Metas individuais (opcional)</h6>
                </div>
                <div class="col-md-3">
                  <label class="form-label">Serviços avulsos (R$)</label>
                  <input type="number" min="0" step="0.01" class="form-control" id="metaAvulsos">
                </div>
                <div class="col-md-3">
                  <label class="form-label">Serviços extras (R$)</label>
                  <input type="number" min="0" step="0.01" class="form-control" id="metaExtras">
                </div>
                <div class="col-md-3">
                  <label class="form-label">Cortes (R$)</label>
                  <input type="number" min="0" step="0.01" class="form-control" id="metaCortes">
                </div>
                <div class="col-md-3">
                  <label class="form-label">Produtos (R$)</label>
                  <input type="number" min="0" step="0.01" class="form-control" id="metaProdutos">
                </div>
                <div class="col-md-3">
                  <label class="form-label">Assinaturas (R$)</label>
                  <input type="number" min="0" step="0.01" class="form-control" id="metaAssinaturas">
                </div>
              </form>
            </div>
          </div>

          <div class="card card-soft mt-4">
            <div class="card-header d-flex align-items-center justify-content-between">
              <h5 class="mb-0"><i class="bi bi-people"></i> Equipe</h5>
              <div class="d-flex gap-2">
                <select id="fCargo" class="form-select form-select-sm" style="width:auto">
                  <option value="">Todos os cargos</option>
                  <option value="Barbeiro">Barbeiro</option>
                  <option value="Assistente">Assistente</option>
                </select>
                <div class="form-check ms-2">
                  <input class="form-check-input" type="checkbox" id="chkSomente">
                  <label class="form-check-label" for="chkSomente">Somente este membro</label>
                </div>
              </div>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table align-middle">
                  <thead>
                    <tr>
                      <th></th>
                      <th>Nome</th>
                      <th>Cargo</th>
                      <th>Telefone</th>
                      <th>Status</th>
                      <th class="text-end">Ações</th>
                    </tr>
                  </thead>
                  <tbody id="tbodyEquipe"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Resumo -->
        <div class="col-12 col-xxl-4">
          <div class="card card-soft h-100">
            <div class="card-header">
              <h5 class="mb-0"><i class="bi bi-person-vcard"></i> Resumo do Membro</h5>
            </div>
            <div class="card-body" id="painelResumo">
              <div class="text-secondary">Selecione um membro para ver o mini-dashboard.</div>
            </div>
          </div>
        </div>

      </div>
    </section>
  </main>

  <!-- Early Access Modal -->
  <div class="modal fade" id="earlyModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="border-radius: var(--radius-lg);">
        <div class="modal-header">
          <h5 class="modal-title"><i class="bi bi-lightning-charge"></i> Acesso Antecipado</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="mb-3 text-secondary">Recursos em beta; obrigado por participar do acesso antecipado.</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Fechar</button>
          <button class="btn btn-primary" id="btnQueroTestar"><i class="bi bi-stars"></i> Quero participar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Helpers
    const $$ = (s,ctx=document)=>Array.from(ctx.querySelectorAll(s));
    const $  = (s,ctx=document)=>ctx.querySelector(s);

    const TEAM_KEY = 'amaralbarber:team:v1';
    let equipe = [];

    /* ===== LocalStorage ===== */
    function loadTeam(){
      try{ const raw = localStorage.getItem(TEAM_KEY); if(raw) equipe = JSON.parse(raw)||[]; }
      catch(e){ console.warn('Erro ao ler equipe', e); equipe = []; }
    }
    function saveTeam(){
      try{ localStorage.setItem(TEAM_KEY, JSON.stringify(equipe)); toast('Equipe salva'); }
      catch(e){ console.warn('Erro ao salvar equipe', e); }
    }

    /* ===== UI ===== */
    function toast(msg){
      const el=document.createElement('div');
      el.className='position-fixed top-0 start-50 translate-middle-x mt-3 z-3';
      el.innerHTML=`<div class="toast align-items-center text-bg-primary border-0 show" role="alert"><div class="d-flex"><div class="toast-body fw-semibold">${msg}</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button></div></div>`;
      document.body.appendChild(el);
      setTimeout(()=>el.remove(),2500);
    }
    function uid(){ return 'm'+Math.random().toString(36).slice(2,9); }

    function renderTable(){
      const tb = $('#tbodyEquipe'); if(!tb) return;
      tb.innerHTML='';
      const cargoFiltro = $('#fCargo') ? $('#fCargo').value : '';
      const somenteEste = $('#chkSomente') ? $('#chkSomente').checked : false;
      const idAtual = $('#membroId') ? $('#membroId').value : '';

      let data = equipe.filter(m => !cargoFiltro || m.cargo === cargoFiltro);
      if(somenteEste && idAtual) data = data.filter(m => m.id === idAtual);

      if(!data.length){
        tb.innerHTML = `<tr><td colspan="6" class="text-center text-secondary py-5">Nenhum membro cadastrado.</td></tr>`;
        return;
      }
      data.forEach(m =>{
        const tr = document.createElement('tr');
        tr.setAttribute('data-id', m.id);
        tr.innerHTML = `
          <td><div class="avatar">${(m.nome||'?').trim().split(' ').map(n=>n[0]).slice(0,2).join('').toUpperCase()}</div></td>
          <td>
            <button class="btn btn-link p-0 text-decoration-none" data-act="select" data-id="${m.id}" title="Selecionar">
              ${m.nome}
            </button>
          </td>
          <td>${m.cargo}</td>
          <td>${m.telefone||'-'}</td>
          <td>${m.ativo!==false?'<span class="badge text-bg-success">Ativo</span>':'<span class="badge text-bg-secondary">Arquivado</span>'}</td>
          <td class="text-end">
            <div class="btn-group">
              <button class="btn btn-sm btn-outline-primary" data-act="edit" data-id="${m.id}"><i class="bi bi-pencil"></i> Editar</button>
              <button class="btn btn-sm btn-outline-${m.ativo!==false?'secondary':'success'}" data-act="toggle" data-id="${m.id}">${m.ativo!==false?'<i class="bi bi-archive"></i> Arquivar':'<i class="bi bi-arrow-counterclockwise"></i> Reativar'}</button>
              <button class="btn btn-sm btn-outline-danger" data-act="del" data-id="${m.id}"><i class="bi bi-trash"></i></button>
            </div>
          </td>`;
        tb.appendChild(tr);
      });
    }

    function clearForm(){
      if($('#formMembro')) $('#formMembro').reset();
      if($('#membroId')) $('#membroId').value='';
      if($('#cargo')) $('#cargo').value='Barbeiro';
    }

    function fillForm(m){
      $('#membroId').value=m.id;
      $('#nome').value=m.nome||'';
      $('#telefone').value=m.telefone||'';
      $('#cargo').value=m.cargo||'Barbeiro';
      $('#metaAvulsos').value=m.metaAvulsos||'';
      $('#metaExtras').value=m.metaExtras||'';
      $('#metaCortes').value=m.metaCortes||'';
      $('#metaProdutos').value=m.metaProdutos||'';
      $('#metaAssinaturas').value=m.metaAssinaturas||'';
      renderResumo(m);
    }

    function currentFromForm(){
      return {
        id: ($('#membroId').value || uid()),
        nome: ($('#nome').value||'').trim(),
        telefone: ($('#telefone').value||'').trim(),
        cargo: $('#cargo').value,
        metaAvulsos: parseFloat($('#metaAvulsos').value||0),
        metaExtras: parseFloat($('#metaExtras').value||0),
        metaCortes: parseFloat($('#metaCortes').value||0),
        metaProdutos: parseFloat($('#metaProdutos').value||0),
        metaAssinaturas: parseFloat($('#metaAssinaturas').value||0),
        ativo: true
      };
    }

    function renderResumo(m){
      const box = $('#painelResumo'); if(!box) return;
      if(!m){ box.innerHTML='<div class="text-secondary">Selecione um membro para ver o mini-dashboard.</div>'; return; }
      function progRow(label, val){
        const pct = 0; // integração futura com lançamentos/metas
        return `<div class="mb-3">
          <div class="d-flex justify-content-between small"><span>${label}</span><span>Meta R$ ${Number(val||0).toFixed(2)}</span></div>
          <div class="progress" role="progressbar" aria-label="${label}" aria-valuenow="${pct}" aria-valuemin="0" aria-valuemax="100">
            <div class="progress-bar" style="width:${pct}%">${pct}%</div>
          </div>
        </div>`;
      }
      box.innerHTML = `
        <div class="d-flex align-items-center gap-3 mb-3">
          <div class="avatar">${(m.nome||'?').trim().split(' ').map(n=>n[0]).slice(0,2).join('').toUpperCase()}</div>
          <div>
            <div class="fw-bold">${m.nome}</div>
            <div class="text-secondary small">${m.cargo}</div>
          </div>
        </div>
        ${progRow('Serviços avulsos', m.metaAvulsos)}
        ${progRow('Serviços extras', m.metaExtras)}
        ${progRow('Cortes', m.metaCortes)}
        ${progRow('Produtos', m.metaProdutos)}
        ${progRow('Assinaturas', m.metaAssinaturas)}
      `;
    }

    function handleTableClick(e){
      const btn = e.target.closest('button[data-act]'); if(!btn) return;
      const id = btn.getAttribute('data-id'); const act = btn.getAttribute('data-act');
      const idx = equipe.findIndex(m=>m.id===id); if(idx<0) return;

      if(act==='select'){ $('#membroId').value = id; renderResumo(equipe[idx]); return; }
      if(act==='edit'){ fillForm(equipe[idx]); window.scrollTo({top:0, behavior:'smooth'}); return; }
      if(act==='toggle'){ equipe[idx].ativo = equipe[idx].ativo===false?true:false; saveTeam(); renderTable(); return; }
      if(act==='del'){
        if(confirm('Remover este membro definitivamente?')){
          equipe.splice(idx,1); saveTeam(); renderTable(); clearForm(); renderResumo(null);
        }
        return;
      }
    }

    function applyCollapseState(){
      try{
        const col = localStorage.getItem('amaralbarber:sidebar:collapsed')==='1';
        if(col){ $('#sidebar').classList.add('collapsed'); $('.main').classList.add('collapsed'); }
      }catch(e){}
    }

    function attachHandlers(){
      // animação
      requestAnimationFrame(()=> $$('[data-anim]').forEach(el=> el.classList.add('in')));

      // salvar
      const btnSalvar = $('#btnSalvarMembro');
      if(btnSalvar){
        btnSalvar.addEventListener('click', ()=>{
          const curr = currentFromForm();
          if(!curr.nome){ alert('Informe o nome'); return; }
          const i = equipe.findIndex(m=>m.id===curr.id);
          if(i>=0){ equipe[i] = {...equipe[i], ...curr}; } else { equipe.push(curr); }
          saveTeam(); renderTable(); renderResumo(curr);
        });
      }
      // limpar
      const btnLimpar = $('#btnLimpar');
      if(btnLimpar){ btnLimpar.addEventListener('click', ()=>{ clearForm(); renderResumo(null); }); }

      // tabela
      const tbody = $('#tbodyEquipe'); if(tbody){ tbody.addEventListener('click', handleTableClick); }

      // filtros
      if($('#fCargo')) $('#fCargo').addEventListener('change', renderTable);
      if($('#chkSomente')) $('#chkSomente').addEventListener('change', renderTable);

      // collapse sidebar
      const btnCollapse = $('#btnCollapseSidebar');
      if(btnCollapse){
        btnCollapse.addEventListener('click', ()=>{
          const sb=$('#sidebar'); const main=$('.main');
          sb.classList.toggle('collapsed'); main.classList.toggle('collapsed');
          try{ localStorage.setItem('amaralbarber:sidebar:collapsed', sb.classList.contains('collapsed')?'1':'0'); }catch(e){}
        });
      }
    }

    function setActiveNav(){
      const path=(location.pathname.split('/').pop()||'gerenciar.html').toLowerCase();
      $$('.nav-link[href]').forEach(a=>{
        const href=(a.getAttribute('href')||'').toLowerCase();
        if(href===path){ a.classList.add('active'); }
      });
    }

    /* ===== Boot ===== */
    loadTeam();
    setActiveNav();
    applyCollapseState();
    attachHandlers();
    renderTable();

    // CTA do Early Access (feedback visual)
    document.addEventListener('click', (e)=>{
      const t = e.target;
      if(t && (t.id === 'btnQueroTestar' || t.closest?.('#btnQueroTestar'))){
        toast('Obrigado! Você será priorizado nas novidades.');
      }
    });
  </script>
</body>
</html>
