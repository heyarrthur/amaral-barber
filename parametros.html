<!doctype html>
<html lang="pt-br" data-bs-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Parâmetros • Amaral Barber</title>

  <!-- Bootstrap 5.3 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root{
      --brand:#0d6efd;
      --brand-600:#0b5ed7;
      --ink:#0f172a;
      --subtle:#6b7280;
      --bg:#f6f8fb;
      --card:#ffffff;
      --border:#e6eaf0;
      --chip:#eef2ff;
      --chip-text:#3730a3;
      --radius:16px;
      --radius-lg:20px;
      --shadow-sm:0 6px 18px rgba(2,6,23,.06);
      --shadow-lg:0 20px 50px rgba(2,6,23,.08);
    }

    html, body{height:100%;background:var(--bg);}

    /* ===== Sidebar ===== */
    .sidebar{
      position:fixed; inset:0 auto 0 0; width:300px;
      background:linear-gradient(180deg,#ffffff 0%,#f9fbff 100%);
      border-right:1px solid var(--border); z-index:1040; display:flex; flex-direction:column;
      box-shadow: 6px 0 28px rgba(2,6,23,.06);
    }
    .brand{ padding:24px 22px 10px; font-weight:800; letter-spacing:.2px; color:var(--ink); font-size:1.35rem;}
    .divider{ margin:10px 16px; border-top:1px dashed var(--border); }
    .sub{ padding:12px 20px 6px; font-size:.78rem; color:#94a3b8; text-transform:uppercase; font-weight:700; letter-spacing:.08em;}
    .nav-main{ padding:8px 10px 18px; overflow:auto;}
    .nav-link{ display:flex; align-items:center; gap:12px; padding:12px 14px; border-radius:var(--radius); color:#0f172a; font-weight:600; transition: transform .2s ease, box-shadow .2s ease, background .2s ease;}
    .nav-link .bi{ font-size:1.1rem; opacity:.95;}
    .nav-link:hover{ background: rgba(13,110,253,.09); transform: translateX(3px); box-shadow: var(--shadow-sm);}
    .nav-link.active{ background: var(--brand); color:#fff; box-shadow:0 10px 28px rgba(13,110,253,.28);}
    .btn-as-link{ background:none; border:0; }
    .btn-as-link:focus-visible{ outline: 3px solid rgba(13,110,253,.35); border-radius: var(--radius);}

    /* Collapse */
    .sidebar.collapsed{ width:84px; }
    .sidebar.collapsed .sub, .sidebar.collapsed .divider, .sidebar.collapsed .mt-auto{ display:none !important; }
    .sidebar.collapsed .brand .title{ display:none; }
    .sidebar .collapse-btn{ margin-left:auto; }
    .sidebar.collapsed .nav-link{ justify-content:center; padding:12px; }
    .sidebar.collapsed .nav-link .label{ display:none; }
    .main{ margin-left:300px; min-height:100%;}
    .main.collapsed{ margin-left:84px; }

    /* ===== Conteúdo ===== */
    .page{ padding:44px; }
    .card-soft{ background:var(--card); border:1px solid var(--border); border-radius:var(--radius-lg); box-shadow:var(--shadow-lg);}
    .card-soft .card-header{ background:transparent; border-bottom:1px solid var(--border); padding:16px 20px;}
    .form-control, .form-select{ padding:.7rem .9rem; border-radius: 12px; border-color: var(--border);}
    .form-control:focus, .form-select:focus{ box-shadow:0 0 0 .25rem rgba(13,110,253,.15); border-color: var(--brand-600);}
    .btn{ border-radius: 12px;}

    .form-switch .form-check-input{ width:3rem; height:1.5rem;}

    .chip{ display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; background:var(--chip); color:var(--chip-text); border:1px solid rgba(99,102,241,.2); font-weight:600;}
    .chip .btn-close{ filter: invert(13%) sepia(58%) saturate(1759%) hue-rotate(226deg) brightness(89%) contrast(95%); opacity:.8;}

    /* Anim */
    [data-anim]{ opacity:0; transform: translateY(8px); transition: all .5s ease;}
    [data-anim].in{ opacity:1; transform: translateY(0);}

    /* Responsivo */
    @media (max-width: 991.98px){
      .sidebar{ transform: translateX(-100%); transition: transform .3s ease;}
      .sidebar.show{ transform: translateX(0);}
      .main{ margin-left:0;}
      .main.collapsed{ margin-left:0;}
    }
  </style>
</head>
<body>
  <!-- ===== Sidebar ===== -->
  <aside class="sidebar" id="sidebar">
    <div class="brand d-flex align-items-center gap-2">
      <i class="bi bi-scissors"></i> <span class="title">Amaral Barber</span>
      <button class="btn btn-light btn-sm collapse-btn" id="btnCollapseSidebar" title="Recolher/expandir" aria-label="Recolher/expandir">
        <i class="bi bi-layout-sidebar-inset"></i>
      </button>
    </div>
    <hr class="divider">
    <nav class="nav-main">
      <button type="button" class="nav-link w-100 text-start btn-as-link" id="btnEarlyAccess" data-bs-toggle="modal" data-bs-target="#earlyModal" title="Acesso Antecipado">
        <i class="bi bi-lightning-charge"></i> <span class="label">Acesso Antecipado</span>
      </button>
      <hr class="divider">
      <div class="sub">Geral</div>
      <a class="nav-link" href="dashboard.html" title="Dashboard">
        <i class="bi bi-speedometer2"></i> <span class="label">Dashboard</span>
      </a>
      <a class="nav-link" href="parametros.html" title="Parâmetros">
        <i class="bi bi-sliders"></i> <span class="label">Parâmetros</span>
      </a>
      <hr class="divider">
      <div class="sub">Faturamento</div>
      <a class="nav-link" href="financeiro.html" title="Financeiro">
        <i class="bi bi-wallet2"></i> <span class="label">Financeiro</span>
      </a>
      <a class="nav-link" href="lancamentos.html" title="Lançamentos Diários">
        <i class="bi bi-journal-text"></i> <span class="label">Lançamentos Diários</span>
      </a>
      <hr class="divider">
      <div class="sub">Equipe</div>
      <a class="nav-link" href="gerenciar.html" title="Gerenciar Equipe">
        <i class="bi bi-people"></i> <span class="label">Gerenciar</span>
      </a>
      <a class="nav-link" href="estatisticas.html" title="Estatísticas">
        <i class="bi bi-graph-up"></i> <span class="label">Estatísticas</span>
      </a>
    </nav>
    <div class="mt-auto p-3 small text-secondary">
      <div class="d-flex align-items-center gap-2">
        <i class="bi bi-cloud-check"></i>
        <span>Dados salvos no navegador (LocalStorage)</span>
      </div>
    </div>
  </aside>

  <!-- ===== Main ===== -->
  <main class="main">
    <section class="page container-xxl">
      <div class="row g-4" data-anim style="max-width: 1400px;">
        <div class="col-12">
          <div class="card card-soft">
            <div class="card-header d-flex align-items-center justify-content-between">
              <h5 class="mb-0"><i class="bi bi-sliders"></i> Configurações de Período & Calendário</h5>
              <div class="d-flex gap-2">
                <button class="btn btn-outline-secondary" id="btnReset"><i class="bi bi-arrow-counterclockwise"></i> Resetar</button>
                <button class="btn btn-primary" id="btnSalvar"><i class="bi bi-cloud-arrow-up"></i> Salvar</button>
              </div>
            </div>
            <div class="card-body">
              <form id="formParametros" class="row g-4">
                <!-- Período -->
                <div class="col-12">
                  <label class="form-label fw-semibold">Período</label>
                  <div class="row g-3">
                    <div class="col-md-4">
                      <select class="form-select" id="periodo" required>
                        <option value="Diário">Diário</option>
                        <option value="Semanal">Semanal</option>
                        <option value="Quinzenal">Quinzenal</option>
                        <option value="Mensal">Mensal</option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Ano</label>
                      <input type="number" min="2000" max="2099" step="1" class="form-control" id="ano" placeholder="2025" required>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Mês</label>
                      <select class="form-select" id="mes" required>
                        <option value="1">Janeiro</option>
                        <option value="2">Fevereiro</option>
                        <option value="3">Março</option>
                        <option value="4">Abril</option>
                        <option value="5">Maio</option>
                        <option value="6">Junho</option>
                        <option value="7">Julho</option>
                        <option value="8">Agosto</option>
                        <option value="9">Setembro</option>
                        <option value="10">Outubro</option>
                        <option value="11">Novembro</option>
                        <option value="12">Dezembro</option>
                      </select>
                    </div>
                  </div>
                </div>

                <!-- Condicionais -->
                <div class="col-12" id="grpSemanas" hidden>
                  <label class="form-label fw-semibold">Semana</label>
                  <div class="d-flex gap-2 flex-wrap">
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="semana" id="sem1" value="1">
                      <label class="form-check-label" for="sem1">Semana 1</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="semana" id="sem2" value="2">
                      <label class="form-check-label" for="sem2">Semana 2</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="semana" id="sem3" value="3">
                      <label class="form-check-label" for="sem3">Semana 3</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="semana" id="sem4" value="4">
                      <label class="form-check-label" for="sem4">Semana 4</label>
                    </div>
                  </div>
                </div>

                <div class="col-12" id="grpQuinzena" hidden>
                  <label class="form-label fw-semibold">Quinzena</label>
                  <div class="d-flex gap-2">
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="quinzena" id="qz1" value="1">
                      <label class="form-check-label" for="qz1">1ª Quinzena</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="quinzena" id="qz2" value="2">
                      <label class="form-check-label" for="qz2">2ª Quinzena</label>
                    </div>
                  </div>
                </div>

                <div class="col-12" id="grpMesRef" hidden>
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label class="form-label fw-semibold">Mês de referência</label>
                      <select class="form-select" id="mesRef">
                        <option value="1">Janeiro</option>
                        <option value="2">Fevereiro</option>
                        <option value="3">Março</option>
                        <option value="4">Abril</option>
                        <option value="5">Maio</option>
                        <option value="6">Junho</option>
                        <option value="7">Julho</option>
                        <option value="8">Agosto</option>
                        <option value="9">Setembro</option>
                        <option value="10">Outubro</option>
                        <option value="11">Novembro</option>
                        <option value="12">Dezembro</option>
                      </select>
                      <div class="form-text">Usado quando o filtro for Semanal, Quinzenal ou Mensal.</div>
                    </div>
                  </div>
                </div>

                <hr>

                <!-- Domingo e Dias fechados -->
                <div class="col-12 col-lg-6">
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" id="abrirDomingo">
                    <label class="form-check-label fw-semibold" for="abrirDomingo">Abrir aos domingos</label>
                  </div>
                </div>

                <div class="col-12">
                  <label class="form-label fw-semibold">Dias extras fechados (feriados/folgas)</label>
                  <div class="row g-2 align-items-end">
                    <div class="col-sm-4 col-md-3 col-lg-2">
                      <input type="date" class="form-control" id="dtExtra">
                    </div>
                    <div class="col-auto">
                      <button type="button" class="btn btn-outline-primary" id="btnAddExtra">
                        <i class="bi bi-plus-circle"></i> Adicionar
                      </button>
                    </div>
                  </div>
                  <div class="mt-3 d-flex gap-2 flex-wrap" id="listaExtras"></div>
                </div>

                <div class="col-12">
                  <div class="alert alert-info d-flex align-items-start gap-2">
                    <i class="bi bi-info-circle"></i>
                    <div>
                      Essas configurações são globais e afetam o <strong>Dashboard</strong>, <strong>Lançamentos</strong>, <strong>Metas</strong> e <strong>Estatísticas</strong>. Domingos e dias extras fechados são considerados nos cálculos de metas e previsões.
                    </div>
                  </div>
                </div>

              </form>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Early Access Modal -->
  <div class="modal fade" id="earlyModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="border-radius: var(--radius-lg);">
        <div class="modal-header">
          <h5 class="modal-title"><i class="bi bi-lightning-charge"></i> Acesso Antecipado</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="mb-3 text-secondary">Obrigado por testar as novidades do <strong>Amaral Barber</strong>! Recursos em <em>beta</em> podem mudar a qualquer momento.</p>
          <div class="d-flex align-items-center gap-2 small text-secondary">
            <i class="bi bi-shield-check"></i>
            <span>Seu feedback ajuda a priorizar correções e melhorias de UX.</span>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Fechar</button>
          <button class="btn btn-primary" id="btnQueroTestar"><i class="bi bi-stars"></i> Quero participar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Utils
    const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));
    const $ = (sel, ctx=document) => ctx.querySelector(sel);
    const STORAGE_KEY = 'amaralbarber:parametros:v1';

    // Estado
    const state = {
      periodo: 'Diário',
      ano: new Date().getFullYear(),
      mes: new Date().getMonth()+1,
      mesRef: new Date().getMonth()+1,
      semana: '1',
      quinzena: '1',
      abrirDomingo: false,
      extras: []
    };

    // LocalStorage
    function load(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(raw){ Object.assign(state, JSON.parse(raw)); }
      }catch(e){ console.warn('LS inválido', e); }
    }
    function save(){
      try{
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        toast('Parâmetros salvos');
      }catch(e){ console.warn('Falha ao salvar', e); }
    }

    // UI helpers
    function toast(msg){
      const el = document.createElement('div');
      el.className = 'position-fixed top-0 start-50 translate-middle-x mt-3 z-3';
      el.innerHTML = `<div class="toast align-items-center text-bg-primary border-0 show" role="alert"><div class="d-flex"><div class="toast-body fw-semibold">${msg}</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button></div></div>`;
      document.body.appendChild(el);
      setTimeout(()=> el.remove(), 2500);
    }
    function setActiveNav(){
      const path = (location.pathname.split('/').pop() || 'parametros.html').toLowerCase();
      $$('.nav-link[href]').forEach(a => {
        const href = (a.getAttribute('href')||'').toLowerCase();
        if(href === path){ a.classList.add('active'); }
      });
    }
    function renderChips(){
      const wrap = $('#listaExtras');
      if(!wrap) return;
      wrap.innerHTML = '';
      if(!state.extras || !state.extras.length){
        wrap.innerHTML = '<span class="text-secondary">Nenhum dia extra fechado.</span>';
        return;
      }
      state.extras.sort().forEach(date => {
        const chip = document.createElement('span');
        chip.className = 'chip';
        chip.innerHTML = `<i class="bi bi-calendar-x"></i> ${date} <button type="button" class="btn-close" aria-label="Remover"></button>`;
        chip.querySelector('.btn-close').addEventListener('click', () => {
          state.extras = state.extras.filter(d => d !== date);
          renderChips();
          save();
        });
        wrap.appendChild(chip);
      });
    }
    function syncUI(){
      if($('#periodo')) $('#periodo').value = state.periodo;
      if($('#ano')) $('#ano').value = state.ano;
      if($('#mes')) $('#mes').value = String(state.mes);
      if($('#mesRef')) $('#mesRef').value = String(state.mesRef);
      if($('#abrirDomingo')) $('#abrirDomingo').checked = !!state.abrirDomingo;

      if(state.periodo === 'Semanal'){
        $('#grpSemanas').hidden = false; $('#grpQuinzena').hidden = true; $('#grpMesRef').hidden = false;
        const sem = $(`input[name="semana"][value="${state.semana}"]`); if(sem) sem.checked = true;
      }else if(state.periodo === 'Quinzenal'){
        $('#grpSemanas').hidden = true; $('#grpQuinzena').hidden = false; $('#grpMesRef').hidden = false;
        const qz = $(`input[name="quinzena"][value="${state.quinzena}"]`); if(qz) qz.checked = true;
      }else if(state.periodo === 'Mensal'){
        $('#grpSemanas').hidden = true; $('#grpQuinzena').hidden = true; $('#grpMesRef').hidden = false;
      }else{ // Diário
        $('#grpSemanas').hidden = true; $('#grpQuinzena').hidden = true; $('#grpMesRef').hidden = true;
      }
      renderChips();
    }
    function clampYear(v){
      let n = parseInt(v||new Date().getFullYear(), 10);
      if(isNaN(n)) n = new Date().getFullYear();
      n = Math.min(2099, Math.max(2000, n));
      if($('#ano')) $('#ano').value = n;
      return n;
    }

    function attachHandlers(){
      // animação de entrada
      requestAnimationFrame(()=> $$('[data-anim]').forEach(el=> el.classList.add('in')));

      // Form
      if($('#periodo')) $('#periodo').addEventListener('change', e=>{ state.periodo = e.target.value; syncUI(); save();});
      if($('#ano')) $('#ano').addEventListener('input', e=>{ state.ano = clampYear(e.target.value);});
      if($('#mes')) $('#mes').addEventListener('change', e=>{ state.mes = Number(e.target.value); save();});
      if($('#mesRef')) $('#mesRef').addEventListener('change', e=>{ state.mesRef = Number(e.target.value); save();});

      $$('#grpSemanas input[name="semana"]').forEach(r => r.addEventListener('change', e=>{ state.semana = e.target.value; save();}));
      $$('#grpQuinzena input[name="quinzena"]').forEach(r => r.addEventListener('change', e=>{ state.quinzena = e.target.value; save();}));

      if($('#abrirDomingo')) $('#abrirDomingo').addEventListener('change', e=>{ state.abrirDomingo = e.target.checked; save();});

      if($('#btnAddExtra')) $('#btnAddExtra').addEventListener('click', ()=>{
        const v = $('#dtExtra').value;
        if(!v) return;
        if(!state.extras.includes(v)) state.extras.push(v);
        $('#dtExtra').value = '';
        renderChips();
        save();
      });

      if($('#btnSalvar')) $('#btnSalvar').addEventListener('click', ()=>{
        state.ano = clampYear($('#ano').value);
        save();
      });

      if($('#btnReset')) $('#btnReset').addEventListener('click', ()=>{
        localStorage.removeItem(STORAGE_KEY);
        Object.assign(state, {periodo:'Diário', ano:new Date().getFullYear(), mes:new Date().getMonth()+1, mesRef:new Date().getMonth()+1, semana:'1', quinzena:'1', abrirDomingo:false, extras:[]});
        syncUI();
        toast('Parâmetros resetados');
      });

      if($('#ano')) $('#ano').addEventListener('change', ()=>{ state.ano = clampYear($('#ano').value); save(); });

      // Collapse sidebar
      const btnCollapse = $('#btnCollapseSidebar');
      if(btnCollapse){
        btnCollapse.addEventListener('click', ()=>{
          const sb = $('#sidebar');
          const main = $('.main');
          sb.classList.toggle('collapsed');
          main.classList.toggle('collapsed');
          try{ localStorage.setItem('amaralbarber:sidebar:collapsed', sb.classList.contains('collapsed') ? '1':'0'); }catch(e){}
        });
      }

      // Restaurar estado do collapse
      try{
        const col = localStorage.getItem('amaralbarber:sidebar:collapsed') === '1';
        if(col){ $('#sidebar').classList.add('collapsed'); $('.main').classList.add('collapsed'); }
      }catch(e){}
    }

    // Boot
    load();
    setActiveNav();
    syncUI();
    attachHandlers();

    // Early access CTA
    document.addEventListener('click', (e)=>{
      const t = e.target;
      if(t && (t.id === 'btnQueroTestar' || t.closest?.('#btnQueroTestar'))){
        toast('Obrigado! Você será priorizado nas novidades.');
      }
    });
  </script>
</body>
</html>
